---
import billeteraDigitalIcon from "@/assets/billetera-digital-icon.png";
import tarjetaIcon from "@/assets/tarjeta-icon.png";
import billetera_01 from "@/assets/billetera-1.png";
import googlePlay from "@/assets/googleplay.png";
import huawei from "@/assets/huawei.png";
import appStore from "@/assets/appstore.png";
import qrApp from "@/assets/qr-app.jpg";
import "swiper/css/bundle";
---


<section class="claro-recibos detail_intern hidden py-10">
  <div class="container mx-auto px-4">
    <h2 class="text-2xl lg:text-4xl font-bold text-center text-[#3c3c3c] mb-10">
      Claro Hogar y recibos móviles
    </h2>

    <div class="recibos-section max-w-6xl mx-auto rounded-2xl overflow-hidden">
      <!-- Tabs -->
      <div class="tabs-container overflow-x-auto flex items-end">
        <div class="tabs-wrapper flex flex-row justify-start md:justify-center md:mx-auto">
          <button 
            class="tab-button group flex items-center gap-2.5 p-4 md:p-5 text-left font-bold text-base md:text-lg text-[#6c6c6c] bg-transparent border-none cursor-pointer relative w-fit transition-all duration-500 hover:text-[#3c3c3c]"
            data-category="claro_hogar_y_recibos_moviles"
            data-sub-category="paga_con_billetera_digital"
          >
            <img 
              src={billeteraDigitalIcon.src} 
              alt="Icono de billetera" 
              class="grayscale group-[.active]:grayscale-0 transition-all duration-500"
            />
            <p class="text-sm md:text-base whitespace-nowrap">Paga con billetera digital</p>
            <div class="absolute bottom-0 left-0 right-0 w-full h-0.5 bg-gradient-to-r from-transparent via-[#b9b9b9] to-transparent group-[.active]:via-[#da291c] transition-all duration-500"></div>
          </button>
          
          <button 
            class="tab-button group flex flex-row items-center gap-2.5 p-4 md:p-5 text-left font-bold text-base md:text-lg text-[#6c6c6c] bg-transparent border-none cursor-pointer relative w-[240px] transition-all duration-500 hover:text-[#3c3c3c]"
            data-category="claro_hogar_y_recibos_moviles"
            data-sub-category="paga_con_tarjeta"
          >
            <img 
              src={tarjetaIcon.src} 
              alt="Icono de tarjeta" 
              class="grayscale group-[.active]:grayscale-0 transition-all duration-500"
            />
            <p class="text-sm md:text-base">Paga con tarjeta</p>
            <div class="absolute bottom-0 left-0 right-0 w-full h-0.5 bg-gradient-to-r from-transparent via-[#b9b9b9] to-transparent group-[.active]:via-[#da291c] transition-all duration-500"></div>
          </button>
        </div>
      </div>

      <!-- Billetera Digital Content -->
      <div class="tab-content relative pt-5">
        <!-- Contenedor del Tutorial -->
        <div class="billetera-digital-container md:flex md:justify-between lg:justify-center items-center bg-white rounded-2xl py-4 pb-0 md:p-6 lg:p-8 gap-4 lg:gap-8">
          <!-- Tutorial Info - Ordenado primero en móvil -->
          <div class="tutorial-info md:w-[calc(100%-220px)] lg:w-[500px] flex flex-col justify-center order-1 md:order-2">
            <div class="tutorial-content flex-col items-start md:px-7 relative">
              <div class="bg-[#f4f4f4] w-full max-w-full rounded-xl lg:h-[160px] ">
                <div class="tutorial-pagination flex items-center gap-1 px-6 pt-4 font-normal text-sm text-[#6c6c6c]">
                  <span class="current-step">1</span> de <span class="total-steps">4</span> pasos
                </div>
                <!-- Swiper container -->
                <div class="swiper tutorial-swiper px-6 pt-1 pb-4 relative">
                  <div class="swiper-wrapper">
                    <!-- Slide 1 -->
                    <div class="swiper-slide">
                      <div class="tutorial-content_info relative rounded-lg mx-auto">
                        <p id="tutorial-description" class="font-normal text-lg text-[#3c3c3c] mb-0">
                          Ingresa a Mi Claro App en tu servicio postpago o Claro Hogar y
                          selecciona el ícono
                        </p>
                      </div>
                    </div>
                    
                    <!-- Slide 2 -->
                    <div class="swiper-slide">
                      <div class="tutorial-content_info relative rounded-lg mx-auto">
                        <p id="tutorial-description" class="font-normal text-lg text-[#3c3c3c] mb-0">
                          Selecciona la opción de pago que prefieras usar
                        </p>
                      </div>
                    </div>
                    
                    <!-- Slide 3 -->
                    <div class="swiper-slide">
                      <div class="tutorial-content_info relative rounded-lg mx-auto">
                        <p id="tutorial-description" class="font-normal text-lg text-[#3c3c3c] mb-0">
                          Ingresa los datos solicitados para completar tu pago
                        </p>
                      </div>
                    </div>
                    
                    <!-- Slide 4 -->
                    <div class="swiper-slide">
                      <div class="tutorial-content_info relative rounded-lg mx-auto">
                        <p id="tutorial-description" class="font-normal text-lg text-[#3c3c3c] mb-0">
                          ¡Listo! Tu pago ha sido procesado exitosamente
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="hidden md:flex btns_swiper">
                <!-- Navigation buttons -->
                <div class="swiper-button-prev after:font-black border-2 -left-4 top-14 text-gray-700 hover:text-white border-gray-700 bg-transparent hover:border-gray-700 hover:bg-gray-700 rounded-full w-[40px] h-[40px] transition-colors duration-200 ease-out"></div>
                <div class="swiper-button-next after:font-black border-2 -right-4 top-14 text-gray-700 hover:text-white border-gray-700 bg-transparent hover:border-gray-700 hover:bg-gray-700 rounded-full w-[40px] h-[40px] transition-colors duration-200 ease-out"></div>
              </div>
              <!-- Pagination bullets -->
              <div class="swiper-pagination relative bottom-0 top-0 mt-3"></div>
              <!-- QR Section -->
              <div class="tutorial-qr md:w-full flex justify-center items-center md:justify-center gap-5 mx-auto pt-8 pb-4">
                <!-- Apps QR - Hidden on mobile -->
                <div class="tutorial-qr_apps hidden md:flex items-center gap-2.5">
                  <div class="qr-app text-center">
                    <p class="text-sm mb-1">Googleplay</p>
                    <img src={googlePlay.src} alt="QR Googleplay" class="w-15 h-15 mx-auto" />
                  </div>

                  <div class="qr-app text-center">
                    <p class="text-sm mb-1">Huawei</p>
                    <img src={huawei.src} alt="QR Huawei" class="w-15 h-15 mx-auto" />
                  </div>

                  <div class="qr-app text-center">
                    <p class="text-sm mb-1">Appstore</p>
                    <img src={appStore.src} alt="QR Appstore" class="w-15 h-15 mx-auto" />
                  </div>
                </div>

                <!-- Main QR - Shown on mobile -->
                <div class="tutorial-qr_img block md:hidden">
                  <img src={qrApp.src} class="w-15 h-15" alt="QR App" />
                </div>

                <div class="tutorial-qr_description md:text-center">
                  <h3 class="font-bold text-lg text-[#3c3c3c] mb-1">Mi Claro APP</h3>
                  <p class="font-normal text-base leading-tight text-[#6c6c6c]">
                    Escanea el código <br />y descarga la app
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- Tutorial Image - Ordenado segundo en móvil -->
          <div class="tutorial-image flex md:max-w-[290px] lg:max-w-[340px] justify-center items-center order-2 md:order-1">
            <div class="tutorial-images-container relative">
              <!-- Imagen para el paso 1 (visible por defecto) -->
              <img 
                src={billetera_01.src} 
                alt="Tutorial paso 1" 
                class="tutorial-img w-full h-full rounded-xl object-contain"
              />
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  import Swiper from "swiper/bundle";
  import paga_con_billetera_digital_paso_01 from "@/assets/claro_hogar_y_recibos_moviles/paga_con_billetera_digital/paso_01.png";
  import paga_con_billetera_digital_paso_02 from "@/assets/claro_hogar_y_recibos_moviles/paga_con_billetera_digital/paso_02.png";
  import paga_con_billetera_digital_paso_03 from "@/assets/claro_hogar_y_recibos_moviles/paga_con_billetera_digital/paso_03.png";
  import paga_con_billetera_digital_paso_04 from "@/assets/claro_hogar_y_recibos_moviles/paga_con_billetera_digital/paso_04.png";
  import paga_con_billetera_digital_paso_05 from "@/assets/claro_hogar_y_recibos_moviles/paga_con_billetera_digital/paso_05.png";
  import paga_con_billetera_digital_paso_06 from "@/assets/claro_hogar_y_recibos_moviles/paga_con_billetera_digital/paso_06.png";
  import paga_con_billetera_digital_paso_07 from "@/assets/claro_hogar_y_recibos_moviles/paga_con_billetera_digital/paso_07.png";
  import paga_con_tarjeta_paso_01 from "@/assets/claro_hogar_y_recibos_moviles/paga_con_tarjeta/paso_01.png";
  import paga_con_tarjeta_paso_02 from "@/assets/claro_hogar_y_recibos_moviles/paga_con_tarjeta/paso_02.png";
  import paga_con_tarjeta_paso_03 from "@/assets/claro_hogar_y_recibos_moviles/paga_con_tarjeta/paso_03.png";
  import paga_con_tarjeta_paso_04 from "@/assets/claro_hogar_y_recibos_moviles/paga_con_tarjeta/paso_04.png";
  import paga_con_tarjeta_paso_05 from "@/assets/claro_hogar_y_recibos_moviles/paga_con_tarjeta/paso_05.png";

  // Estructura de datos más plana y organizada
  const dataTabs = {
    "claro_hogar_y_recibos_moviles": {
      "paga_con_billetera_digital": [
        {
          text: `Ingresa a <strong>Mi Claro App</strong> en tu <strong>servicio postpago</strong> o <strong>Claro Hogar</strong> y selecciona el ícono <strong>Pagos</strong>.`,
          image: paga_con_billetera_digital_paso_01.src
        },
        {
          text: `Elige el recibo en la pestaña Pendientes de pago, acepta los Términos y Condiciones y selecciona Pagar.`,
          image: paga_con_billetera_digital_paso_02.src
        },
        {
          text: `Elige una Billetera digital como medio de pago y selecciona Continuar.`,
          image: paga_con_billetera_digital_paso_03.src
        },
        {
          text: `Ingresa a la Billetera digital y selecciona Aprobar compras.`,
          image: paga_con_billetera_digital_paso_04.src
        },
        {
          text: `Copia el Código de aprobación y regresa a Mi Claro App.`,
          image: paga_con_billetera_digital_paso_05.src
        },
        {
          text: `En Mi Claro App, ingresa tu número afiliado a la Billetera digital, pega el código y confirma el pago.`,
          image: paga_con_billetera_digital_paso_06.src
        },
        {
          text: `¡Listo! Verás el mensaje de pago exitoso y recibirás tu confirmación.`,
          image: paga_con_billetera_digital_paso_07.src
        }
      ],
      "paga_con_tarjeta": [
        {
          text: `Ingresa a <strong>Mi Claro App</strong> en tu <strong>servicio postpago</strong> o <strong>Claro Hogar</strong> y selecciona el ícono <strong>Pagos</strong>.`,
          image: paga_con_tarjeta_paso_01.src
        },
        {
          text: `Elige el recibo en la pestaña Pendientes de pago, acepta los Términos y Condiciones y selecciona Pagar.`,
          image: paga_con_tarjeta_paso_02.src
        },
        {
          text: `Elige una Billetera digital como medio de pago y selecciona Continuar.`,
          image: paga_con_tarjeta_paso_03.src
        },
        {
          text: `Ingresa a la Billetera digital y selecciona Aprobar compras.`,
          image: paga_con_tarjeta_paso_04.src
        },
        {
          text: `Copia el Código de aprobación y regresa a Mi Claro App.`,
          image: paga_con_tarjeta_paso_05.src
        }
      ]
    }
    // Otras categorías principales si las hubiera
  };

  // Función para obtener parámetros de la URL actual
  const getUrlParameter = (name) => {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(name);
  }
  // Función para actualizar la URL sin recargar la página
  const updateUrlWithoutReload = (category, subCategory) => {
    const url = new URL(window.location.href);
    
    if (category) {
      url.searchParams.set('category_tab', category);
    } else {
      url.searchParams.delete('category_tab');
    }
    
    if (subCategory) {
      url.searchParams.set('subcategory_tab', subCategory);
    } else {
      url.searchParams.delete('subcategory_tab');
    }
    
    // Actualiza la URL sin recargar la página
    window.history.pushState({ category, subCategory }, '', url.toString());
  }

  let tutorialSwiper;
  // Función para actualizar la imagen del tutorial
  function updateTutorialImage(imageSrc = null) {
    const currentImage = document.querySelector('.tutorial-img') as HTMLImageElement;
    if (currentImage && imageSrc) {
      currentImage.src = imageSrc;
    }
  }

  
  // Función mejorada para generar el slider
  const generateSliderSwiper = (category, subCategory) => {
    // Acceso directo a los slides
    const slides = dataTabs[category]?.[subCategory];
    
    // Si no hay slides, salir de la función
    if (!slides || !slides.length) return;
    
    // Actualizar contador de pasos
    const totalStepsEl = document.querySelector('.total-steps');
    const currentStepEl = document.querySelector('.current-step');
    if (totalStepsEl) {
      totalStepsEl.textContent = slides.length.toString();
    }
    if (currentStepEl) {
      currentStepEl.textContent = '1';
    }
    
    // Actualizar la imagen del primer paso
    if (slides.length > 0) {
      updateTutorialImage(slides[0].image);
    }
    
    // Destruir el swiper existente si existe
    if (tutorialSwiper) {
      tutorialSwiper.destroy(true, true);
    }
    
    // Reconstruir el contenedor del swiper
    const swiperContainer = document.querySelector('.tutorial-swiper');
    if (!swiperContainer) return;
    
    // Crear el HTML para los slides
    let swiperHTML = '<div class="swiper-wrapper">';
    slides.forEach((slideData) => {
      swiperHTML += `
        <div class="swiper-slide">
          <div class="tutorial-content_info relative rounded-lg mx-auto">
            <p id="tutorial-description" class="font-normal text-lg text-[#3c3c3c] mb-0">
              ${slideData.text}
            </p>
          </div>
        </div>
      `;
    });
    swiperHTML += '</div>';
    
    // Actualizar el HTML
    swiperContainer.innerHTML = swiperHTML;
    
    // Inicializar un nuevo swiper
    tutorialSwiper = new Swiper('.tutorial-swiper', {
        slidesPerView: 1,
        spaceBetween: 30,
        loop: false,
        autoHeight: true,
        navigation: {
          nextEl: '.swiper-button-next',
          prevEl: '.swiper-button-prev',
        },
        pagination: {
          el: '.tutorial-content .swiper-pagination',
          clickable: true,
        },
        effect: 'fade',
        fadeEffect: {
          crossFade: true
        },
        on: {
          slideChange: function() {
            const activeIndex = this.activeIndex;
            if (slides[activeIndex]) {
              updateTutorialImage(slides[activeIndex].image);
            }
            
            const currentStepEl = document.querySelector('.current-step');
            if (currentStepEl) {
              currentStepEl.textContent = (activeIndex + 1).toString();
            }
          }
        }
      });
    };

  document.addEventListener('DOMContentLoaded', function() {   
    // Inicializar Swiper
    tutorialSwiper = new Swiper('.tutorial-swiper', { });
    // Event listeners para los botones de tabs
    const tabButtons = document.querySelectorAll('.tab-button');
    tabButtons.forEach(button => {
      button.addEventListener('click', function() {
        tabButtons.forEach(btn => btn.classList.remove('active'));
        this.classList.add('active');
        const category = this.getAttribute('data-category');
        const subCategory = this.getAttribute('data-sub-category');
        // Actualizar URL sin recargar
        updateUrlWithoutReload(category, subCategory);
        generateSliderSwiper(category, subCategory);
      });
    });
    // Inicializar desde la URL actual al cargar la página
    const initialCategory = getUrlParameter('category_tab');
    const initialSubCategory = getUrlParameter('subcategory_tab');
    if (initialCategory && initialSubCategory) {
      // Activar el botón correspondiente
      tabButtons.forEach(btn => {
        if (btn.getAttribute('data-category') === initialCategory && 
            btn.getAttribute('data-sub-category') === initialSubCategory) {
          btn.classList.add('active');
        }
      });
      const mainSections = document.querySelectorAll(".main_section");
      const internSections = document.querySelectorAll(".detail_intern");
      mainSections.forEach(section => section.classList.add("hidden"));
      internSections.forEach(section => section.classList.remove("hidden"));
      console.log(initialCategory, initialSubCategory);
      // Inicializar el slider
      generateSliderSwiper(initialCategory, initialSubCategory);
    }
      
  });

  window.addEventListener('popstate', function(event) {
    if (event.state) {
      const { category, subCategory } = event.state;
      const tabButtons = document.querySelectorAll('.tab-button');
      // Activar el botón correspondiente
      tabButtons.forEach(btn => {
        btn.classList.remove('active');
        if (btn.getAttribute('data-category') === category && 
            btn.getAttribute('data-sub-category') === subCategory) {
          btn.classList.add('active');
        }
      });
      // Generar slider con los parámetros del estado
      generateSliderSwiper(category, subCategory);
    } else {
      // Si no hay estado (ej: primera carga), usar valores por defecto o de URL
      const category = getUrlParameter('category_tab') || 'claro_hogar_y_recibos_moviles';
      const subCategory = getUrlParameter('subcategory_tab') || 'paga_con_billetera_digital';
      generateSliderSwiper(category, subCategory);
    }
  });

  document.addEventListener('categoryChanged', function(e: CustomEvent) {
    const { category, subCategory } = e.detail;
    // Activar el botón correspondiente
    const tabButtons = document.querySelectorAll('.tab-button');
    tabButtons.forEach(btn => {
      btn.classList.remove('active');
      if (btn.getAttribute('data-category') === category && btn.getAttribute('data-sub-category') === subCategory) {
        btn.classList.add('active');
      }
    });
    // Generar slider
    generateSliderSwiper(category, subCategory);
  });

</script>